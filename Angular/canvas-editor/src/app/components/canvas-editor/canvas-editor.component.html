<div class="editor-container">
  <header class="editor-header">
    <div class="header-left">
      <span class="editing-label">
        <mat-icon>edit</mat-icon>
        Editing
      </span>
      <button mat-icon-button (click)="undo()" [disabled]="!canUndo">
        <mat-icon>undo</mat-icon>
      </button>
      <button mat-icon-button (click)="redo()" [disabled]="!canRedo">
        <mat-icon>redo</mat-icon>
      </button>
    </div>
    <div class="header-center">
      <input
        class="file-name"
        [(ngModel)]="fileName"
        (blur)="onFileNameChange()"
        (keyup.enter)="onFileNameChange()"
        [readonly]="!isEditingFileName"
        (dblclick)="isEditingFileName = true"
      />
    </div>
    <div class="header-right">
      <button class="share-btn" (click)="share()">
        <mat-icon>share</mat-icon>
        Share
      </button>
    </div>
  </header>

  <div class="toolbar">
    <button (click)="showAddTextModal = true">Add Text</button>
    <button (click)="showAddImageModal = true">Add Image</button>
    <button (click)="deleteSelected()" [disabled]="!selectedId">Delete Selected</button>
    <button (click)="bringForward()" [disabled]="!selectedId">Bring Forward</button>
    <button (click)="sendBackward()" [disabled]="!selectedId">Send Backward</button>
    <button (click)="toggleAspectRatio()" [class.active]="lockAspectRatio">
      <mat-icon>aspect_ratio</mat-icon>
      Lock Aspect Ratio
    </button>
    <button (click)="shareDesign()">Share Design</button>
  </div>

  <div class="workspace">
    <div class="canvas-scroll-container" #scrollContainer>
      <div class="canvas-pages-col">
        <div *ngFor="let page of pages; let i = index" class="canvas-page-wrapper" #canvasPageWrapper [class.selected]="i === selectedPageIndex" (click)="onPageClick(i)">
          <div class="canvas-page-title">{{ page.title }}</div>
          <div class="canvas-container" #container></div>
        </div>
      </div>
    </div>
    <div class="page-table-panel">
      <div class="page-table-header">
        <span>Page Table</span>
        <button (click)="addPage()" title="Add Page">+</button>
      </div>
      <ul class="page-table-list">
        <li *ngFor="let page of pages; let i = index">
          <button (click)="scrollToPage(i)">
            <span *ngIf="!editingPageIndexMap[i]">{{ page.title }}</span>
            <input *ngIf="editingPageIndexMap[i]" [(ngModel)]="page.title" (blur)="stopEditingPageName(i)" (keydown.enter)="stopEditingPageName(i)" class="page-title-input" />
          </button>
          <button class="edit-page-btn" (click)="editPageName(i); $event.stopPropagation();" title="Edit Page Name">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
            </svg>
          </button>
          <button class="delete-page-btn" (click)="deletePage(i); $event.stopPropagation();" [disabled]="pages.length === 1" title="Delete Page">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#d9534f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </button>
        </li>
      </ul>
    </div>
  </div>

  <!-- Add Text Modal -->
  <div class="modal" *ngIf="showAddTextModal">
    <div class="modal-content">
      <h2>Add Text</h2>
      <div class="form-group">
        <label>Text:</label>
        <input type="text" [(ngModel)]="newText" placeholder="Enter text">
      </div>
      <div class="form-group">
        <label>Font Size:</label>
        <input type="number" [(ngModel)]="fontSize" min="8" max="72">
      </div>
      <div class="form-group">
        <label>Color:</label>
        <input type="color" [(ngModel)]="textColor">
      </div>
      <div class="modal-actions">
        <button (click)="addText()">Add</button>
        <button (click)="showAddTextModal = false">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Add Image Modal -->
  <div class="modal" *ngIf="showAddImageModal">
    <div class="modal-content">
      <h2>Add Image</h2>
      <div class="form-group">
        <label>Image URL:</label>
        <input type="text" [(ngModel)]="newImageUrl" placeholder="Enter image URL">
      </div>
      <div class="modal-actions">
        <button (click)="addImage(newImageUrl)">Add</button>
        <button (click)="showAddImageModal = false">Cancel</button>
      </div>
    </div>
  </div>

  <div *ngIf="textToolbarVisible && textToolbarElement" class="floating-text-toolbar">
    <select [(ngModel)]="textToolbarElement.fontFamily" (change)="updateTextElement({ fontFamily: textToolbarElement.fontFamily })">
      <option *ngFor="let font of fontFamilies" [value]="font">{{ font }}</option>
    </select>
    <input type="number" min="8" max="120" [(ngModel)]="textToolbarElement.fontSize" (input)="updateTextElement({ fontSize: textToolbarElement.fontSize })" style="width: 60px;" />
    <input type="color" [(ngModel)]="textToolbarElement.color" (input)="updateTextElement({ color: textToolbarElement.color })" />
    <button (click)="toggleBold()" [class.active]="textToolbarElement.fontWeight === 'bold'">B</button>
    <button (click)="toggleItalic()" [class.active]="textToolbarElement.fontStyle === 'italic'">I</button>
    <button (click)="toggleUnderline()" [class.active]="textToolbarElement.textDecoration === 'underline'">U</button>
    <select [(ngModel)]="textToolbarElement.align" (change)="updateTextElement({ align: textToolbarElement.align })">
      <option *ngFor="let align of alignments" [value]="align">{{ align }}</option>
    </select>
    <label>Spacing
      <input type="range" min="0" max="20" step="0.5" [(ngModel)]="textToolbarElement.letterSpacing" (input)="updateTextElement({ letterSpacing: textToolbarElement.letterSpacing })" />
    </label>
    <label>Line
      <input type="range" min="0.8" max="3" step="0.05" [(ngModel)]="textToolbarElement.lineHeight" (input)="updateTextElement({ lineHeight: textToolbarElement.lineHeight })" />
    </label>
  </div>

  <div *ngIf="shapeToolbarVisible && shapeToolbarElement" class="floating-shape-toolbar">
    <label>Fill Color: <input type="color" [(ngModel)]="shapeToolbarElement.fill" (input)="updateShapeElement({ fill: shapeToolbarElement.fill })" /></label>
    <label>Stroke Color: <input type="color" [(ngModel)]="shapeToolbarElement.stroke" (input)="updateShapeElement({ stroke: shapeToolbarElement.stroke })" /></label>
  </div>
</div>

<div class="left-sidebar">
  <button 
    class="sidebar-btn" 
    [class.active]="activeSection === 'design'" 
    (click)="activeSection = activeSection === 'design' ? null : 'design'">
    <span class="material-icons">dashboard_customize</span>
    <span>Design</span>
  </button>
  <button 
    class="sidebar-btn" 
    [class.active]="activeSection === 'elements'" 
    (click)="activeSection = activeSection === 'elements' ? null : 'elements'">
    <span class="material-icons">category</span>
    <span>Elements</span>
  </button>
  <button 
    class="sidebar-btn" 
    [class.active]="activeSection === 'text'" 
    (click)="activeSection = activeSection === 'text' ? null : 'text'">
    <span class="material-icons">text_fields</span>
    <span>Text</span>
  </button>
  <button 
    class="sidebar-btn" 
    [class.active]="activeSection === 'uploads'" 
    (click)="activeSection = activeSection === 'uploads' ? null : 'uploads'">
    <span class="material-icons">cloud_upload</span>
    <span>Uploads</span>
  </button>
</div>

<div class="sidebar-content" *ngIf="activeSection">
  <ng-container [ngSwitch]="activeSection">
    <div *ngSwitchCase="'design'">
      <h3>Design</h3>
      <button class="text-btn heading" (click)="addHeading()">Add Heading</button>
      <button class="text-btn subheading" (click)="addSubheading()">Add Subheading</button>
      <button class="text-btn body" (click)="addBodyText()">Add Body Text</button>
      <!-- Design content here -->
    </div>
    <div *ngSwitchCase="'elements'">
      <h3>Elements</h3>
      <div class="elements-panel">
        <button (click)="addShape('rect')">Rectangle</button>
        <button (click)="addShape('circle')">Circle</button>
        <button (click)="addShape('ellipse')">Ellipse</button>
        <button (click)="addShape('star')">Star</button>
        <div class="color-pickers">
          <label>Fill Color: <input type="color" [(ngModel)]="shapeFillColor" /></label>
          <label>Stroke Color: <input type="color" [(ngModel)]="shapeStrokeColor" /></label>
        </div>
      </div>
    </div>
    <div *ngSwitchCase="'text'">
      <h3>Text</h3>
      <!-- Text content here -->
    </div>
    <div *ngSwitchCase="'uploads'">
      <h3>Uploads</h3>
      <div class="uploads-panel">
        <input type="file" accept="image/*,video/*" (change)="onFileUpload($event)" />
        <div *ngIf="uploadedFiles.length > 0">
          <h4>Uploaded Files</h4>
          <ul>
            <li *ngFor="let file of uploadedFiles">
              <img *ngIf="file.type.startsWith('image/')" [src]="file.url" alt="Uploaded Image" style="width: 100px; height: 100px;" />
              <video *ngIf="file.type.startsWith('video/')" [src]="file.url" controls style="width: 100px; height: 100px;"></video>
              <button (click)="useFile(file)">Use</button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </ng-container>
</div>
